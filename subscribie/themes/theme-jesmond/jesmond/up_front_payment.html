{% extends "layout.html" %}
{% block title %} Up-front payment {% endblock %}

{% block hero %}                                                                 
                                                                                 
	<div class="columns vertical-align is-mobile">                               
	  <div class="column">                                                       
		<h1 class="title is-1 has-text-white is-size-2-mobile">{{ company.name }}</h1>
		<h2 class="subtitle has-text-white is-3 is-size-3-mobile">Upfront Payment</h2>
	  </div>                                                                     
		  <div class="column is-one-third is-hidden-touch" style="text-align:right">
			<svg style="max-width:500px; width:75%" viewBox="0 0 1309 490" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
				<title>Payment</title>
				<defs></defs>
				<g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
					<g id="Artboard" fill="#FFFFFF">
						<g id="Group-2" transform="translate(419.000000, 122.000000)">
							<g id="Group">
								<path d="M39.5387097,65 C39.5387097,63.8954305 40.4341402,63 41.5387097,63 L303.46129,63 C304.56586,63 305.46129,63.8954305 305.46129,65 L305.46129,73.5387097 C305.46129,74.6432792 306.356721,75.5387097 307.46129,75.5387097 L316,75.5387097 C317.104569,75.5387097 318,76.4341402 318,77.5387097 L318,206.358065 C318,207.462634 317.104569,208.358065 316,208.358065 L307.46129,208.358065 C306.356721,208.358065 305.46129,209.253495 305.46129,210.358065 L305.46129,218.896774 C305.46129,220.001344 304.56586,220.896774 303.46129,220.896774 L41.5387097,220.896774 C40.4341402,220.896774 39.5387097,220.001344 39.5387097,218.896774 L39.5387097,210.358065 C39.5387097,209.253495 38.6432792,208.358065 37.5387097,208.358065 L29,208.358065 C27.8954305,208.358065 27,207.462634 27,206.358065 L27,77.5387097 C27,76.4341402 27.8954305,75.5387097 29,75.5387097 L37.5387097,75.5387097 C38.6432792,75.5387097 39.5387097,74.6432792 39.5387097,73.5387097 L39.5387097,65 Z M169.632632,162.927912 L169.632632,150.262242 L194.253263,150.262242 L194.253263,134.684923 L169.632632,134.684923 L169.632632,125.804396 C169.632632,117.942945 173.420421,111.391736 182.161474,111.391736 C185.657895,111.391736 189.591368,112.410813 194.836,117.65178 L208.238947,101.055385 C199.206526,91.1557802 187.988842,89.1176264 180.558947,89.1176264 C160.308842,89.1176264 144.574947,101.055385 144.574947,126.823473 L144.574947,134.684923 L137.290737,134.684923 L137.290737,150.262242 L144.574947,150.262242 L144.574947,163.510242 C144.574947,170.207033 143.700842,173.555429 137.582105,178.650813 L140.204421,194.956044 L204.596842,194.956044 L204.596842,173.555429 L168.758526,173.555429 C169.341263,170.352615 169.632632,166.713055 169.632632,162.927912 Z" id="Path"></path>
								<g id="if_48_842670" transform="translate(0.000000, 38.000000)" fill-rule="nonzero">
									<path d="M329.018366,0.793733926 C337.051864,0.793733926 343.624726,7.85022212 344.355044,15.6907646 L344.355044,191.318915 C344.355044,199.943512 337.782182,207 329.748684,207 L14.9816338,207 C6.94813596,207 0.375274123,199.943512 0.375274123,191.318915 L0.375274123,16.4748188 C0.375274123,7.85022212 6.94813596,0.793733926 14.9816338,0.793733926 L329.018366,0.793733926 Z M22,192 C24.7614237,192 27,189.761424 27,187 C27,184.238576 24.7614237,182 22,182 C19.2385763,182 17,184.238576 17,187 C17,189.761424 19.2385763,192 22,192 Z M323,192 C325.761424,192 328,189.761424 328,187 C328,184.238576 325.761424,182 323,182 C320.238576,182 318,184.238576 318,187 C318,189.761424 320.238576,192 323,192 Z M22,26 C24.7614237,26 27,23.7614237 27,21 C27,18.2385763 24.7614237,16 22,16 C19.2385763,16 17,18.2385763 17,21 C17,23.7614237 19.2385763,26 22,26 Z M323,26 C325.761424,26 328,23.7614237 328,21 C328,18.2385763 325.761424,16 323,16 C320.238576,16 318,18.2385763 318,21 C318,23.7614237 320.238576,26 323,26 Z M34.5387097,17 C32.8818554,17 31.5387097,18.3431458 31.5387097,20 L31.5387097,26.5387097 C31.5387097,28.1955639 30.1955639,29.5387097 28.5387097,29.5387097 L22,29.5387097 C20.3431458,29.5387097 19,30.8818554 19,32.5387097 L19,175.358065 C19,177.014919 20.3431458,178.358065 22,178.358065 L28.5387097,178.358065 C30.1955639,178.358065 31.5387097,179.70121 31.5387097,181.358065 L31.5387097,187.896774 C31.5387097,189.553628 32.8818554,190.896774 34.5387097,190.896774 L310.46129,190.896774 C312.118145,190.896774 313.46129,189.553628 313.46129,187.896774 L313.46129,181.358065 C313.46129,179.70121 314.804436,178.358065 316.46129,178.358065 L323,178.358065 C324.656854,178.358065 326,177.014919 326,175.358065 L326,32.5387097 C326,30.8818554 324.656854,29.5387097 323,29.5387097 L316.46129,29.5387097 C314.804436,29.5387097 313.46129,28.1955639 313.46129,26.5387097 L313.46129,20 C313.46129,18.3431458 312.118145,17 310.46129,17 L34.5387097,17 Z" id="Combined-Shape"></path>
								</g>
								<path d="M21,23 C21,19.5675164 21,15.7341831 21,11.5 C21,5.14872538 26.0970659,0 32.3846154,0 L305.615385,0 C311.902934,0 317,5.14872538 317,11.5 C317,15.7341831 317,19.5675164 317,23 L21,23 Z" id="Line-10" fill-rule="nonzero"></path>
							</g>
							<path d="M419,246 C390.281193,246 367,222.494949 367,193.5 C367,164.505051 390.281193,141 419,141 C447.718807,141 471,164.505051 471,193.5 C471,222.494949 447.718807,246 419,246 Z M423.144,171.168 C419.944,171.168 417.128,172.192 414.696,173.92 L414.696,172 L404.136,172 L404.136,216.16 L415.592,216.16 L415.592,204.128 C417.128,204.576 418.792,204.832 420.648,204.832 C429.864,204.832 437.096,198.24 437.096,187.552 C437.096,177.184 430.376,171.168 423.144,171.168 Z M419,242.5 C420.381485,242.5 421.756144,242.442203 423.121572,242.32725 L422.869899,239.337825 C421.588151,239.445733 420.297458,239.5 419,239.5 L419,242.5 Z M425.177602,242.110113 C426.546224,241.936071 427.90294,241.704238 429.245035,241.41559 L428.61424,238.482657 C427.355533,238.75337 426.083008,238.970817 424.799151,239.13408 L425.177602,242.110113 Z M431.280892,240.931258 C432.614982,240.583091 433.93155,240.178293 435.227636,239.718228 L434.22409,236.891057 C433.008783,237.322448 431.774284,237.702013 430.523335,238.028482 L431.280892,240.931258 Z M437.151124,238.988832 C438.428681,238.472911 439.682842,237.902708 440.910506,237.28001 L439.553428,234.604502 C438.402026,235.188519 437.225837,235.723272 436.027764,236.207095 L437.151124,238.988832 Z M442.766341,236.287343 C443.965677,235.611887 445.135641,234.88562 446.273114,234.110746 L444.584109,231.631379 C443.516911,232.35838 442.419292,233.039738 441.294185,233.673388 L442.766341,236.287343 Z M447.922468,232.936155 C449.026901,232.114461 450.096127,231.246172 451.127135,230.33387 L449.139099,228.087158 C448.171535,228.943322 447.168131,229.758158 446.13173,230.529236 L447.922468,232.936155 Z M452.65747,228.920331 C453.647995,227.965415 454.597782,226.968938 455.504059,225.933775 L453.246879,223.957633 C452.396338,224.929134 451.504949,225.864341 450.575327,226.760544 L452.65747,228.920331 Z M456.853615,224.323571 C457.714695,223.250009 458.529941,222.140403 459.29691,220.997818 L456.806049,219.325809 C456.086399,220.397901 455.321412,221.439102 454.513382,222.446522 L456.853615,224.323571 Z M460.431216,219.226242 C461.148198,218.051119 461.814935,216.845823 462.429383,215.613484 L459.744603,214.274845 C459.168268,215.430744 458.542849,216.561347 457.870257,217.663715 L460.431216,219.226242 Z M463.302785,213.76479 C463.863967,212.508747 464.371494,211.228541 464.823744,209.927232 L461.989997,208.942407 C461.565921,210.16265 461.089997,211.363139 460.563736,212.541022 L463.302785,213.76479 Z M465.444202,208.013888 C465.840788,206.697795 466.181373,205.363449 466.464745,204.013728 L463.528754,203.397322 C463.263021,204.663025 462.943654,205.914245 462.571781,207.148325 L465.444202,208.013888 Z M466.849049,201.964017 C467.072783,200.609996 467.239387,199.243428 467.348018,197.866919 L464.357316,197.630899 C464.255378,198.922597 464.099068,200.204737 463.889183,201.474939 L466.849049,201.964017 Z M467.467958,195.779052 C467.489227,195.189503 467.499923,194.59855 467.5,194.006379 C467.5,193.214609 467.481319,192.430564 467.443955,191.648338 L464.447371,191.791475 C464.482456,192.525979 464.5,193.262298 464.5,194.006185 C464.499928,194.562227 464.489882,195.117249 464.469908,195.67089 L467.467958,195.779052 Z M467.30217,189.59071 C467.17821,188.215742 466.996302,186.85117 466.757319,185.499626 L463.803146,186.021988 C464.02732,187.289782 464.197976,188.569948 464.314288,189.860082 L467.30217,189.59071 Z M466.349988,183.454605 C466.051448,182.10834 465.695823,180.777945 465.28436,179.466318 L462.421903,180.364282 C462.807722,181.594164 463.141188,182.841659 463.421136,184.104089 L466.349988,183.454605 Z M464.625561,177.513648 C464.157222,176.217765 463.633822,174.943563 463.057022,173.694115 L460.333253,174.951524 C460.874173,176.123253 461.364993,177.318139 461.804164,178.533315 L464.625561,177.513648 Z M462.13771,171.811182 C461.507173,170.587739 460.824763,169.391936 460.092563,168.2269 L457.552546,169.823243 C458.239439,170.916191 458.879585,172.037932 459.471034,173.185531 L462.13771,171.811182 Z M458.97066,166.52237 C458.189907,165.388736 457.361264,164.288644 456.487209,163.22515 L454.169533,165.129981 C454.989757,166.127976 455.767335,167.160275 456.499939,168.223998 L458.97066,166.52237 Z M455.130216,161.644163 C454.211532,160.618985 453.249753,159.633037 452.247683,158.689174 L450.190735,160.872971 C451.131193,161.7588 452.033839,162.68413 452.89603,163.646265 L455.130216,161.644163 Z M450.697136,157.290106 C449.655739,156.390137 448.576655,155.534619 447.462909,154.7261 L445.700501,157.15384 C446.745618,157.912538 447.758253,158.715373 448.735552,159.559949 L450.697136,157.290106 Z M445.732949,153.526551 C444.585266,152.76702 443.405714,152.056536 442.197416,151.39726 L440.760516,154.030759 C441.893985,154.649207 443.000557,155.315733 444.077296,156.028313 L445.732949,153.526551 Z M440.352025,150.441236 C439.116815,149.834641 437.855729,149.280843 436.571858,148.781586 L435.484569,151.57762 C436.688531,152.045803 437.871177,152.565154 439.02962,153.13405 L440.352025,150.441236 Z M434.706864,148.100268 C433.405915,147.655192 432.085019,147.265559 430.747116,146.932695 L430.022812,149.843946 C431.277349,150.156069 432.51591,150.521416 433.735774,150.938751 L434.706864,148.100268 Z M428.71502,146.473527 C427.369496,146.199908 426.009833,145.983224 424.638723,145.824419 L424.293563,148.804497 C425.579844,148.953477 426.855207,149.156726 428.11719,149.413357 L428.71502,146.473527 Z M422.559174,145.628674 C421.383882,145.543391 420.202061,145.500367 419.015229,145.500002 C418.808485,145.5 418.615059,145.501112 418.419966,145.503399 L418.455143,148.503193 C418.638388,148.501044 418.82008,148.5 419.014751,148.500002 C420.128985,148.500345 421.238694,148.540744 422.342056,148.620807 L422.559174,145.628674 Z M416.357827,145.570786 C414.978581,145.644869 413.608265,145.77694 412.249425,145.966221 L412.663316,148.937533 C413.93826,148.759939 415.224173,148.636002 416.518736,148.566467 L416.357827,145.570786 Z M410.204332,146.295841 C408.846943,146.54456 407.503818,146.850786 406.177791,147.213383 L406.969079,150.107146 C408.212519,149.767132 409.472039,149.479967 410.74503,149.246713 L410.204332,146.295841 Z M404.198307,147.800576 C402.885876,148.220728 401.593427,148.696629 400.323993,149.226737 L401.480026,151.995055 C402.670412,151.497957 403.882337,151.051707 405.112978,150.657739 L404.198307,147.800576 Z M398.410599,150.074977 C397.163863,150.660352 395.94308,151.298659 394.751377,151.987928 L396.253402,154.584834 C397.371248,153.938283 398.516301,153.339573 399.685629,152.790542 L398.410599,150.074977 Z M392.979094,153.064223 C391.818187,153.803649 390.689166,154.592175 389.595118,155.427431 L391.415585,157.811944 C392.442178,157.028187 393.501538,156.288313 394.590755,155.594549 L392.979094,153.064223 Z M387.993031,156.704768 C386.9351,157.58526 385.914797,158.510283 384.935045,159.477116 L387.042242,161.612467 C387.961748,160.705085 388.919303,159.836951 389.912147,159.010628 L387.993031,156.704768 Z M383.479671,160.976145 C382.542557,161.98366 381.648424,163.030434 380.799916,164.113496 L383.161484,165.96363 C383.957759,164.94724 384.796877,163.964872 385.67635,163.019329 L383.479671,160.976145 Z M379.540148,165.795011 C378.738802,166.914191 377.985275,168.066946 377.281846,169.250168 L379.860558,170.783219 C380.520493,169.673157 381.227471,168.591613 381.979355,167.541513 L379.540148,165.795011 Z M376.242404,171.08868 C375.591346,172.301233 374.99213,173.541368 374.446619,174.805972 L377.201255,175.994238 C377.712855,174.808249 378.27485,173.645146 378.885504,172.507844 L376.242404,171.08868 Z M373.707747,176.619226 C373.214668,177.903351 372.776388,179.209142 372.394355,180.533603 L375.276839,181.36504 C375.63506,180.123132 376.046022,178.898729 376.508379,177.694614 L373.707747,176.619226 Z M371.860429,182.547299 C371.537142,183.882524 371.2705,185.233518 371.061553,186.597511 L374.026961,187.051775 C374.22294,185.772437 374.473007,184.505419 374.776181,183.253267 L371.860429,182.547299 Z M370.78983,188.668462 C370.640735,190.031523 370.54886,191.404834 370.514908,192.785924 L373.514002,192.859652 C373.545879,191.562957 373.632119,190.273878 373.772042,188.994664 L370.78983,188.668462 Z M370.50762,194.86824 C370.531893,196.250095 370.614105,197.624439 370.75357,198.988817 L373.738019,198.68375 C373.607124,197.403216 373.529949,196.113073 373.507157,194.815552 L370.50762,194.86824 Z M371.007831,201.042778 C371.206605,202.408822 371.463156,203.762179 371.776457,205.100091 L374.697438,204.416079 C374.403622,203.161378 374.163011,201.892106 373.976567,200.610797 L371.007831,201.042778 Z M372.298758,207.130403 C372.67129,208.45803 373.100211,209.767305 373.584096,211.055239 L376.392431,210.000128 C375.938698,208.79245 375.536512,207.564785 375.187201,206.319908 L372.298758,207.130403 Z M374.347119,212.961698 C374.886201,214.229627 375.47915,215.473314 376.12412,216.689643 L378.774554,215.284226 C378.16962,214.143398 377.61351,212.97698 377.107947,211.787886 L374.347119,212.961698 Z M377.148435,218.524035 C377.845169,219.710566 378.59213,220.866907 379.387058,221.989949 L381.835708,220.256711 C381.089856,219.203002 380.389049,218.118109 379.735404,217.004959 L377.148435,218.524035 Z M380.591914,223.619094 C381.433238,224.70851 382.320486,225.761917 383.251032,226.776331 L385.461771,224.748368 C384.588469,223.796357 383.755818,222.807772 382.966294,221.785431 L380.591914,223.619094 Z M384.694076,228.28343 C385.666889,229.256878 386.680533,230.188818 387.732097,231.076516 L389.667272,228.784116 C388.680395,227.951024 387.729084,227.076394 386.816087,226.162801 L384.694076,228.28343 Z M389.362896,232.394171 C390.452099,233.236142 391.576559,234.031586 392.733194,234.778112 L394.360051,232.257529 C393.274825,231.557093 392.219729,230.810717 391.197669,230.020648 L389.362896,232.394171 Z M394.527262,235.881645 C395.715148,236.577216 396.932358,237.221993 398.175767,237.813992 L399.465389,235.105325 C398.299165,234.550075 397.157445,233.945286 396.043163,233.292814 L394.527262,235.881645 Z M399.970383,238.623942 C401.235628,239.164171 402.524262,239.650362 403.833241,240.080947 L404.770668,237.23117 C403.543255,236.827416 402.334895,236.371512 401.14842,235.864915 L399.970383,238.623942 Z M405.824584,240.688587 C407.147575,241.061204 408.487999,241.377572 409.843009,241.63653 L410.406153,238.68986 C409.135425,238.447008 407.878461,238.150339 406.637884,237.800934 L405.824584,240.688587 Z M411.900657,241.983904 C413.258131,242.183066 414.627384,242.325043 416.005855,242.409039 L416.188318,239.414593 C414.894573,239.33576 413.609736,239.202536 412.336142,239.01568 L411.900657,241.983904 Z M418.092712,242.491678 C418.393546,242.497201 418.694716,242.499977 418.996199,242.5 L418.996429,239.5 C418.713226,239.499978 418.430333,239.497371 418.147774,239.492184 L418.092712,242.491678 Z" id="Combined-Shape"></path>
							<path d="M419.968,195.488 C423.104,195.488 425.92,192.608 425.92,187.36 C425.92,183.776 424.576,180 420.8,180 C419.264,180 417.536,180.704 416,181.92 L416,194.848 C417.408,195.36 418.816,195.488 419.968,195.488 Z" id="p"></path>
						</g>
					</g>
				</g>
			</svg>
		  </div>
	</div>                                                                       
                                                                                 
{% endblock %}

{% block body %} 
<section class="section">
<div class="columns">
    <div class="column">
		<h2 class="title is-3">Please complete your order</h2>
		<p>Great choice {{ fname }}, please complete the form below.</p><br />

		<div class="content">
		<p>
           <b>Pay today:</b>
           <span class="tag is-success is-medium">&pound; {{ "%.2f"|format(plan.sell_price/100) }}</span>
        </p>
		<p>
           <b>Price ({{ plan.interval_unit }})</b>
           <span class="tag is-info is-medium">&pound; {{ "%.2f"|format(plan.interval_amount/100) }}</span>
        </p>
		</div>

     </div><!-- end column 1 -->

    <div class="column">
		<h2 class="title is-4">Order Summary:</h2>

		<h4 class="title is-5 is-size-5-mobile" style="text-align:left">{{ plan.title|capitalize() }}</h4>
		<div class="content">
		<ul>
			{% for selling_point in plan.selling_points %}
			<li>{{ selling_point.point }}</li>
			{% endfor %}
		</ul>
		</div>

    </div><!-- end column 2 -->

</div><!-- end columns -->
<div class="columns">
    <div class="column">
        <button id="checkout-button" class="btn btn-success">Checkout</button>

        <script type="text/javascript">
        // Create an instance of the Stripe
        var stripe = Stripe('{{ stripe_pub_key }}', {
            stripeAccount: "{{ stripe_connected_account_id }}"
        });
        var checkoutButton = document.getElementById('checkout-button');

        checkoutButton.addEventListener('click', function(e) {
            e.target.setAttribute("disabled", "disabled");
            e.target.textContent = "Opening...";
            const account_id = "{{ stripe_connected_account_id }}"
            fetch('{{ stripe_create_checkout_session_url }}', {
                method: 'POST',
                headers: {
                   "Content-Type": "application/json",
                },
                body: JSON.stringify({
                    account_id
                })
            })
            .then(function(response) {
                return response.json();
            })
            .then(function(session) {
                return stripe.redirectToCheckout({ sessionId: session.id });
            })
            .then(function(result) {
                // If `redirectToCheckout` fails due to a browser or network
                // error, you should display the localized error message to your
                // customer using `error.message`.
                if (result.error) {
                    alert(result.error.message);
                }
            })
            .catch(function(error) {
                console.error('Error:', error);
            })
        });
        </script>
    </div>
</div>
</section>
{% endblock %}
