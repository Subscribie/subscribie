{% extends "admin/layout.html" %}
{% block title %} {{ title }} {% endblock %}

{% block body %}

<h2 class="text-center text-dark mb-3">Manager - Assign Plan(s)</h2>

<div class="container">
  <ul class="breadcrumb">
    <li class="breadcrumb-item"><a href="/">Shop</a></li>
    <li class="breadcrumb-item"><a href="{{ url_for('admin.dashboard') }}">Manage My Shop</a></li>
    <li class="breadcrumb-item"><a href="{{ url_for('admin.assign_managers_to_plan') }}">Assign Manager(s) to Plan(s)</a></li>
    <li class="breadcrumb-item active" aria-current="page">Assign user to plan(s)</li>
  </ul>
</div>
      
<main>
  <div class="section">
    <div class="container">

      <h3>Assign Plan(s) to admin: <em>{{ user.email }}</em></h3>
      <p class="card-subtitle text-muted">Tick which plan(s) you want to assign the user to</p>
      <p class="card-subtitle text-muted mb-3">Doing so will make these plans(s) and any associated subscriptions appear more prominently for them when they login.</p>

      <div class="alert alert-warning">
        <h5>Why might I see duplicate plan names below?</h5>
        <p>When you update a plan, such as its price or description, current subscribers keep their original plan details. This ensures they continue under the terms they originally agreed to. That's why you might see duplicated plan names below.</p>
      </div>
      <hr>
      <div class="btn btn-success mb-4" onclick="toggleCheckboxes(true)">Check all</div>
      <div class="btn btn-success mb-4" onclick="toggleCheckboxes(false)">Check none</div>
      <form action="" method="POST" class="col-md-7 py-3">

        <button type="submit" class="btn btn-success btn-block">Save</button>
        <br />
      {% for plan in plans %}
        {% if plan.subscriptions | length > 0 %}
          <div class="input-group mb-3">
            <div class="input-group-prepend">
              <div class="input-group-text">
                <input type="checkbox" name="assign" class="assign-plan-to-manager-checkbox" value="{{ plan.id }}" id="{{ plan.id }}"
                {% if user in plan.users %}
                  checked
                {% endif %}>
              </div>
            </div>
            <label class="form-control" for="{{ plan.id }}">{{ plan.title }}</label>
          </div>
        {% endif %}
      {% endfor %}

      <input type="submit" class="btn btn-success btn-block" value="Save" />
      </form>

    </div><!--end container-->
  </div><!--end section-->
</main>

<script>
  function toggleCheckboxes(toggle) {
    checkboxes = document.getElementsByClassName('assign-plan-to-manager-checkbox')
    for (i=0; i<checkboxes.length;i++) {
      checkboxes[i].checked = toggle;
    }
  }
</script>

{% endblock body %}
